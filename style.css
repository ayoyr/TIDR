/* style.css - 全文 */

/* 基本的なリセットと設定 */
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    overflow: hidden; /* スクロールバーを隠す */
    background-color: #333; /* 初期背景色 (メンバーカラーで動的に変更) */
    transition: background-color 0.5s ease; /* 背景色変化を滑らかに */
    -webkit-font-smoothing: antialiased; /* iOSでのフォントアンチエイリアス */
    -moz-osx-font-smoothing: grayscale; /* Firefoxでのフォントアンチエイリアス */
    text-rendering: optimizeLegibility;
}

.app-container {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: 480px; /* スマートフォン向けに最大幅を設定 (iPhone 12 Pro Maxの幅に近い) */
    margin: 0 auto;    /* 中央揃え */
    background-color: inherit; /* 親要素の背景色を継承 (bodyの動的変更に追従) */
    display: flex;
    flex-direction: column;
    overflow: hidden; /* コンテナ内でのオーバーフローも隠す */
    box-shadow: 0 0 20px rgba(0,0,0,0.2); /* アプリに少し影をつける (任意) */
}

/* 上部プログレスエリア */
.progress-area {
    padding: 10px 15px;
    position: relative; /* z-indexの基準 */
    z-index: 10; /* カードより手前に表示 */
    background-color: rgba(0,0,0,0.1); /* 背景との区別を少しつける (任意) */
    backdrop-filter: blur(2px); /* 背景が透ける場合、少しぼかす (任意、対応ブラウザ注意) */
}

.story-progress-bar {
    display: flex;
    height: 5px; /* 少し細く */
    margin-bottom: 8px;
    gap: 2px; /* セグメント間の隙間 */
}

.story-progress-bar .segment {
    flex-grow: 1;
    background-color: rgba(255, 255, 255, 0.3); /* 半透明白 (背景色によって見え方が変わる) */
    border-radius: 3px;
    transition: background-color 0.3s ease;
}

.story-progress-bar .segment.active {
    background-color: white;
}

.fever-gauge-container {
    display: flex;
    align-items: center;
    height: 12px; /* 少し太く */
    background-color: rgba(0, 0, 0, 0.25); /* ゲージ背景を少し濃く */
    border-radius: 6px; /* 高さに合わせて調整 */
    padding: 2px; /* 内部のゲージとの間に余白 */
    position: relative; /* FEVERテキストを重ねるため */
}

.fever-gauge {
    width: 0%; /* 初期値は0% */
    height: 100%;
    background-color: #ff4081; /* デフォルトのフィーバーゲージ色 */
    border-radius: 4px; /* コンテナのpaddingに合わせて調整 */
    transition: width 0.3s ease, background-color 0.3s ease; /* 色の変更もアニメーション */
}

.fever-gauge-container span { /* "FEVER" テキスト */
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 9px; /* 少し小さく */
    font-weight: bold;
    color: white;
    text-shadow: 0 0 2px rgba(0,0,0,0.5); /* テキストに見やすさのため影 */
}

/* メインカードエリア */
.card-stack-area {
    flex-grow: 1; /* 残りの高さをすべて使用 */
    display: flex;
    justify-content: center;
    align-items: center; /* カードを中央に配置 */
    position: relative; /* カードを重ねるために必要 */
    padding: 10px;
    overflow: hidden; /* はみ出したカードを隠す */
    perspective: 1000px; /* 3D回転のための視点 (任意) */
}

.card {
    width: calc(100% - 20px); /* paddingを考慮した幅 (最大幅は下のmax-widthで指定) */
    height: calc(100% - 20px); /* paddingを考慮した高さ (最大高さは下のmax-heightで指定) */
    max-width: 380px; /* カードの最大幅 */
    max-height: 600px; /* カードの最大高さ */
    background-color: #f0f0f0; /* カードの背景色 (画像がない場合など) */
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2), 0 1px 3px rgba(0,0,0,0.1); /* 少しリッチな影 */
    position: absolute; /* 重ねて表示するため (最後のカードが一番手前になるようにJSで制御) */
    overflow: hidden; /* カード内の画像がはみ出ないように */

    /* スワイプ操作のためのスタイル */
    cursor: grab; /* ドラッグできることを示すカーソル */
    user-select: none; /* テキスト選択を防ぐ */
    -webkit-user-drag: none; /* 画像などのドラッグを防ぐ */
    touch-action: none; /* スワイプ中のブラウザ標準ジェスチャを無効化 (重要) */

    /* 初期状態 (JSで transform, transition を操作) */
    transform-origin: center center;
    /* transition: transform 0.3s ease-out;  JSで制御するのでコメントアウトまたは削除 */
}

.card.dragging { /* ドラッグ中のスタイル (任意) */
    cursor: grabbing;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 6px 10px rgba(0,0,0,0.2); /* ドラッグ中少し持ち上げる感じ */
}

.card img.main-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* アスペクト比を保ちつつ全体をカバー */
    pointer-events: none; /* 画像自体がドラッグイベントを奪わないように */
    display: block; /* img要素下の余白対策 */
}

.card-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 15px 20px; /* 少しパディング調整 */
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.7) 30%, rgba(0,0,0,0) 100%);
    color: white;
    display: flex;
    align-items: flex-end; /* 要素を下揃えに */
    pointer-events: none; /* カード情報部分はスワイプ操作の対象外にする */
}

.profile-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid white; /* メンバーカラーで動的に変更 */
    margin-right: 12px; /* 少し間隔をあける */
    object-fit: cover;
    flex-shrink: 0; /* アイコンが縮まないように */
}

.member-details {
    flex-grow: 1;
    min-width: 0; /* flexアイテム内でのテキスト省略のため */
}

.member-name {
    font-weight: bold;
    font-size: 1.25em; /* 少し大きく */
    margin-bottom: 2px;
    white-space: nowrap; /* 名前は1行で表示 */
    overflow: hidden;
    text-overflow: ellipsis; /* 長い名前は省略 */
}

.member-quote {
    font-size: 0.85em; /* 少し小さく、読みやすく */
    line-height: 1.4; /* 行間を少しあける */
    /* 最大3行で省略 (WebKit系ブラウザ) */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    /* 他のブラウザ用の省略表示はJSでの対応や高さ固定が必要になる場合がある */
    max-height: calc(0.85em * 1.4 * 3); /* おおよその3行分の高さ */
}

/* スワイプ時の評価オーバーレイ */
.swipe-overlay {
    position: absolute;
    top: 35%; /* 表示位置調整 */
    left: 50%;
    transform: translate(-50%, -50%) scale(0.5) rotate(-15deg); /* 初期状態: 少し小さく傾ける */
    width: auto;
    max-width: 120px; /* 少し小さめに */
    height: auto;
    opacity: 0;
    transition: opacity 0.2s ease-out, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* バネっぽい動き */
    pointer-events: none;
    z-index: 100;
}
.swipe-overlay.like-overlay {
    /* transform-origin: bottom left; */ /* 回転の基点を調整する場合 */
}
.swipe-overlay.nope-overlay {
    /* transform-origin: bottom right; */
    transform: translate(-50%, -50%) scale(0.5) rotate(15deg); /* 反対に傾ける */
}

.swipe-overlay.visible { /* 表示時のスタイル */
    opacity: 0.9;
    transform: translate(-50%, -50%) scale(1) rotate(0deg); /* 表示時はまっすぐ大きく */
}


/* 設定ボタン */
.settings-button {
    position: absolute;
    top: 10px;  /* progress-area の高さに応じて調整 */
    right: 15px;
    background: rgba(255,255,255,0.1);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    width: 36px; /* 少し小さく */
    height: 36px;
    font-size: 18px; /* アイコンサイズ */
    line-height: 36px; /* アイコン中央寄せ */
    text-align: center;
    cursor: pointer;
    z-index: 20; /* progress-area より手前、モーダルより奥 */
    transition: background-color 0.2s ease;
}
.settings-button:hover {
    background: rgba(255,255,255,0.2);
}

/* 設定モーダル */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    display: flex; /* 初期は none で JS で flex に変更 */
    justify-content: center;
    align-items: center;
    z-index: 1000; /* 最前面 */
    opacity: 0; /* 初期状態は透明 */
    pointer-events: none; /* 初期状態は操作不可 */
    transition: opacity 0.3s ease-out;
}
.modal-overlay.visible { /* JS でこのクラスを付与して表示 */
    opacity: 1;
    pointer-events: auto;
}

.modal-content {
    background-color: #fff;
    color: #333;
    padding: 25px;
    border-radius: 10px;
    width: 85%;
    max-width: 400px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    transform: scale(0.9); /* 初期状態は少し小さい */
    transition: transform 0.3s ease-out;
}
.modal-overlay.visible .modal-content { /* 表示時に拡大 */
    transform: scale(1);
}

.modal-content h2 {
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.4em;
    text-align: center;
}
.modal-content .member-weight-setting {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.modal-content .member-weight-setting label {
    margin-right: 10px;
    font-size: 0.95em;
}
.modal-content .member-weight-setting input[type="range"] {
    flex-grow: 1;
    margin-right: 10px;
}
.modal-content .member-weight-setting span {
    min-width: 20px; /* 値表示用の幅確保 */
    text-align: right;
    font-size: 0.9em;
}

.modal-content button {
    display: block; /* ボタンをブロック要素に */
    width: calc(100% - 20px); /* 少し左右に余白 */
    margin: 20px auto 0;
    padding: 12px 15px;
    font-size: 1em;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}
.modal-content button#saveSettingsButton {
    background-color: #4CAF50; /* 保存ボタンの色 */
    color: white;
}
.modal-content button#saveSettingsButton:hover {
    background-color: #45a049;
}
.modal-content button#closeSettingsModalButton {
    background-color: #f44336; /* 閉じるボタンの色 */
    color: white;
    margin-top: 10px; /* 保存ボタンとの間隔 */
}
.modal-content button#closeSettingsModalButton:hover {
    background-color: #e53935;
}


/* フィーバー中のスタンプ（仮のスタイル） */
.fever-sticker {
    position: absolute;
    width: 60px; /* ステッカーのサイズ調整 */
    height: auto;
    pointer-events: none;
    z-index: 5; /* カードよりは奥、背景よりは手前 */
    opacity: 0.8;
    /* アニメーションはJSで動的に transform や opacity を設定 */
}

/* 表示するカードがない場合のメッセージ */
.card-stack-area p { /* showNoMoreCardsMessage で表示するpタグ用 */
    color: white;
    text-align: center;
    font-size: 1.1em;
    padding: 20px;
}
